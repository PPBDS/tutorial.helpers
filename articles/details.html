<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tutorial.helpers">
<title>Technical Details • tutorial.helpers</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Technical Details">
<meta property="og:description" content="tutorial.helpers">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tutorial.helpers</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9006</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/details.html">Technical Details</a>
    <a class="dropdown-item" href="../articles/instructions.html">Instructions for Writing Tutorials</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ppbds/tutorial.helpers/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Technical Details</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ppbds/tutorial.helpers/blob/HEAD/vignettes/details.Rmd" class="external-link"><code>vignettes/details.Rmd</code></a></small>
      <div class="d-none name"><code>details.Rmd</code></div>
    </div>

    
    
<p>This document reviews some of the technical details behind the
special modifications we have made to the basic tutorial technology. It
is only of interest to those thinking of modifying the current approach.
It also includes some items worth investigating and/or fixing.</p>
<div class="section level2">
<h2 id="package-locations">Package locations<a class="anchor" aria-label="anchor" href="#package-locations"></a>
</h2>
<!-- DK: Not sure this is true with new version of renv. Maybe there are more? -->
<p>Keep in mind that there are (at least) two versions of
<strong>your.tutorial.package</strong> installed on your machine. In my
case (using <strong>all.primer.tutorials</strong>), we have</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> /Library/Frameworks/R.framework/Versions/4.1/Resources/library</span></code></pre></div>
<p>and</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="op">&gt;</span> /Users/dkane/Library/Caches/org.R-project.R/R/renv/library/all.primer.tutorials-07f29d85/R-4.2/aarch64-apple-darwin20<span class="st">"</span></span></code></pre></div>
<p>The first is the default location for packages. This is where things
go unless you do something special. The second is installed by
<code>renv</code>, which was used within the
<code>all.primer.tutorials</code> project. When you are working in your
<code>all.primer.tutorials</code> project, as you generally will, the
<code>renv</code> version of the <strong>all.primer.tutorials</strong>
library is what you will be using. You can check this by running
<code><a href="https://rdrr.io/r/base/libPaths.html" class="external-link">.libPaths()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="sc">&gt;</span> <span class="fu">.libPaths</span>()</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>[<span class="dv">1</span>] <span class="st">"/Users/dkane/Library/Caches/org.R-project.R/R/renv/library/all.primer.tutorials-07f29d85/R-4.2/aarch64-apple-darwin20"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>[<span class="dv">2</span>] <span class="st">"/Library/Frameworks/R.framework/Versions/4.2-arm64/Resources/library"</span> </span></code></pre></div>
<p>Whenever you <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> a package, R looks through, in
order, the values returned by <code><a href="https://rdrr.io/r/base/libPaths.html" class="external-link">.libPaths()</a></code>.
<strong>renv</strong> sets things up so that the first item is its
collection of packages. Note that these are placed in a weird location,
including a temp directory name
<code>all.primer.tutorials-07f29d85</code>. I am not sure how
<strong>renv</strong> decided to create a new one of these. It does not
delete the old ones. In the case of major breakdowns, deleting these
directories by hand can fix things.</p>
</div>
<div class="section level2">
<h2 id="yaml-and-setup-code-chunk">YAML and setup code chunk<a class="anchor" aria-label="anchor" href="#yaml-and-setup-code-chunk"></a>
</h2>
<p>The top of your file should look like the text below.</p>
<!-- DK: Replace with text. -->
<p><img src="images/tutorial-rmd-beginning.png"><!-- --></p>
<p>Every tutorial must load the <strong>learnr</strong> package in order
to function. <code><a href="https://ppbds.github.io/tutorial.helpers/">library(tutorial.helpers)</a></code> is always included
because it contains the file, <code>submissions_functions.R</code>,
which enables answer downloading. You may need to add other packages
which are used in your tutorial. Any such packages also need to be
included in the DESCRIPTION file.</p>
<p><code>echo = FALSE</code> is a handy default because, most of the
time, we don’t show users the code. Setting the
<code>tutorial.exercise.timelimit</code> to 60 seconds is safe, but
probably not necessary. <code>tutorial.storage</code> must be set to
<code>local</code> to ensure that user work is saved between
sessions.</p>
<p>The other 2 code chunks load in the code for the “Copy Code” button
and the Information section. <strong>Do not remove these code
chunks</strong>. The information section and the copy code button are
crucial infrastructure for the tutorial and these code chunks allow us
to implement them easily without taking too much space.</p>
</div>
<div class="section level2">
<h2 id="copy-code-trickery">Copy Code Trickery<a class="anchor" aria-label="anchor" href="#copy-code-trickery"></a>
</h2>
<div class="section level3">
<h3 id="current-process">Current Process<a class="anchor" aria-label="anchor" href="#current-process"></a>
</h3>
<p>In order to implement copy-pasting for an exercise, you need to add
the line
<code>&lt;button onclick = "transfer_code(this)"&gt;Copy previous code&lt;/button&gt;</code>
either before or after the exercise that you want to copy-paste to. This
will add a button that looks like this:</p>
<p><img src="images/copy-button.png"><!-- --></p>
<p>The user just needs to click the button in order to copy the code
from the previous exercise into the current one.</p>
</div>
<div class="section level3">
<h3 id="possible-improvements">Possible Improvements<a class="anchor" aria-label="anchor" href="#possible-improvements"></a>
</h3>
<p>Personally, I think the current solution is very close to the ideal
solution. The only downsides being that 1) tutorial makers still have to
include something in the exercises and 2) the button would look much
better on the toolbar section of the exercise, next to
<code>"Start Over"</code> and where the “hint” would be.</p>
<p>However, the possibility of automatically copying code to clipboard
when clicking the <code>"Run Code"</code> button has yet been explored
and could offer a better solution.</p>
</div>
</div>
<div class="section level2">
<h2 id="comments-on--rbuildignore">Comments on .Rbuildignore<a class="anchor" aria-label="anchor" href="#comments-on--rbuildignore"></a>
</h2>
<p>For some reason, it is impossible to include comments in the
<code>.Rbuildignore</code>, at least by using the “#” symbol. I think
the key issue is that using <code>*</code> (or maybe a parenthesis) in a
line which begins with <code>#</code> causes trouble. Regardless, here
are some thoughts on the current version.</p>
<p>We would like to ensure that all the junk files which end up in the
<code>tutorials/*</code> directories are not included in the build. Such
files are often large. They also run the risk of messing things up in
that they might cause certain tests to pass for us but which would fail
for anyone who downloads from Github. (The <code>.gitignore</code> file
does a reasonable ensuring that such files do not end up on Github.)</p>
<p>The key line is:</p>
<pre><code>tutorials/[^/]*/(?!(data|images|.*Rmd))</code></pre>
<p>This excludes everything in any subdirectory of the tutorials
directory except an <code>images</code> directory (a file named images
would also be included) or a <code>data</code> directory or a file
suffixed with <code>.Rmd</code>.</p>
</div>
<div class="section level2">
<h2 id="adding-more-libraries">Adding more libraries<a class="anchor" aria-label="anchor" href="#adding-more-libraries"></a>
</h2>
<p>If you are using a new library, there are several things you need to
check. First, most obviously, you should install the package within the
<code>primer.tutorials</code> directory. Second, you must use library(X)
in the setup chunk within the tutorial.Rmd itself. Third, you need to
run <code><a href="https://rstudio.github.io/renv/reference/status.html" class="external-link">renv::status()</a></code>. This should report that there is a new
package which is not part of renv.lock. Then, you will need to run
<code><a href="https://rstudio.github.io/renv/reference/snapshot.html" class="external-link">renv::snapshot()</a></code> so that the renv.lock file is updated.
Fourth, you need to add the package to the DESCRIPTION file, in the
Imports: section. (And don’t forget the comma when you do so.) If you
don’t do this, then R CMD check might work on your computer, where
library X is already installed, but won’t work in Github actions since R
relies on the DESCRIPTION file to know which packages to install.</p>
<p>We have seen weird situations in which even doing all of the above
did not work. The required hack was to install the new package in your
main (default) library. Now, it seems weird that this would help since,
with <strong>renv</strong>, we should never be using that location. I
suspect that there is a bug involved in the interaction between R CMD
check and <strong>renv</strong>.</p>
</div>
<div class="section level2">
<h2 id="tour-of-the-package-functions">Tour of the Package Functions<a class="anchor" aria-label="anchor" href="#tour-of-the-package-functions"></a>
</h2>
<div class="section level3">
<h3 id="submission-functions">Submission Functions<a class="anchor" aria-label="anchor" href="#submission-functions"></a>
</h3>
<p><strong>submission_ui</strong> is an HTML structure defined through
shiny, which is inserted to the end of every tutorial. It creates
buttons to download submission reports in the forms of RDS and HTML.</p>
<p><strong>submission_server()</strong> is a function that communicates
with the shiny server during a tutorial. It provides the download
functions, <strong>downloadHtml</strong> and
<strong>downloadRds</strong>, for the user interface to call when
downloading submission reports.</p>
</div>
<div class="section level3">
<h3 id="submission-helper-functions">Submission Helper Functions<a class="anchor" aria-label="anchor" href="#submission-helper-functions"></a>
</h3>
<p><strong>build_html</strong> is a function that creates and downloads
a tibble report of tutorial submissions in HTML.</p>
<p><strong>build_rds</strong> is a function that creates and downloads
an tibble report of tutorial submissions in RDS.</p>
<p><strong>create_tibble_from_submissions</strong> is a function that
takes in tutorial submissions and creates a formatted tibble with the
columns: id, submission type, and answer. The submissions are arranged
by the order these questions appear in the tutorial</p>
<p><strong>get_label_list</strong> is a function that gets the
appearance order of questions in a tutorial.</p>
<p><strong>get_submissions_from_learnr_session</strong> is a function
that gets submissions of the current tutorial session through learnr
functions, specifically <code>learnr:::get_all_state_objects()</code>
and <code>learnr::submissions_from_state_objects()</code>. It returns a
list of submission objects, each containing details about the question
and answer.</p>
</div>
<div class="section level3">
<h3 id="add-in-functions">Add-in Functions<a class="anchor" aria-label="anchor" href="#add-in-functions"></a>
</h3>
<p><strong>format_tutorial</strong> is a function that takes a tutorial
path and formats the code chunk labels into a standardized format.</p>
<p><strong>check_current_tutorial</strong> is an add-in function that
runs <code><a href="../reference/format_tutorial.html">format_tutorial()</a></code> on the current opened tutorial. It
is a handy add-in for tutorial makers who want to make sure their chunk
labels are correct.</p>
<p><strong>make_new_exercise</strong> is an add-in function that creates
a code exercise with correctly formatted labels and general
structure.</p>
<p><strong>make_new_q_no_answer</strong> is an add-in function that
creates a question exercise that does not have an answer to display with
correctly formatted labels and general structure.</p>
<p><strong>make_new_q_with_answer</strong> is an add-in function that
creates a question exercise that does have an answer to display with
correctly formatted labels and general structure.</p>
</div>
</div>
<div class="section level2">
<h2 id="permanent-objects">Permanent objects<a class="anchor" aria-label="anchor" href="#permanent-objects"></a>
</h2>
<p>Permanent objects should be avoided, if possible. The problem is that
each Exercise code chunk is its own “world.” It knows nothing of any
actions taken in previous code chunks, except for three exceptions:</p>
<ol style="list-style-type: decimal">
<li><p>Any objects created in the global “setup” code chunk are
available in all Exercise code chunks. The annoying thing about this
option is that we would, ideally like to have the obects created near —
in the Rmd — to the Exercises which use them. This also means that we
can only use names like “fit_1” or “pp” once in each tutorial.</p></li>
<li><p>Objects created in a setup chunk for just one exercise.</p></li>
<li><p>Objects created in a code chunk which is then referenced by using
the exercise.setup code chunk option in any Exercise which needs access
to these objects. This is probably the best approach.</p></li>
</ol>
<p>But what about regular code chunks which are neither Exercise code
chunks nor setup chunks. Do objects created there persist? Maybe!
Sometimes!? My <em>sense</em> is that such objects are available when
the tutorial is knitted. This is why we can show a plot at the end of a
Section after creating it at the start. But such objects are not
available at run time, which is why they are not seen in Exercises.</p>
<p>No aspect of the tutorials has given us more trouble than permanent
objects. In particular, it sometimes seems like things will work with
Run Document but not with Run Tutorial. Since students always do the
latter, we need to test that way as well.</p>
</div>
<div class="section level2">
<h2 id="verbatim-code-chunks">Verbatim Code Chunks<a class="anchor" aria-label="anchor" href="#verbatim-code-chunks"></a>
</h2>
<p>See <a href="https://support.rstudio.com/hc/en-us/articles/360018181633-Including-verbatim-R-code-chunks-inside-R-Markdown" class="external-link">here</a>
for advice about how to use verbatim R code chunks within an R Markdown
document, as we do in this document.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by David Kane.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
