# Positron Tutorial Helpers Extension

Anish Talla

## Overview

This extension ("Positron Tutorial Helpers") is a Visual Studio Code / Positron extension that adds convenient commands and a status bar button to insert different types of exercises into `.Rmd` tutorials.

It integrates with the **`tutorial.helpers`** R package, specifically calling `make_exercise()` with different arguments to insert:
- Code exercises
- No-answer exercises
- Yes-answer exercises

It works inside **Positron** with an active R session, allowing quick template insertion for tutorial authors.

---

## Folder Structure

This `positron-tutorial-helpers/` folder contains all source code and build configuration for the extension.

```
positron-tutorial-helpers/
│
├─ src/                   # TypeScript source code
│   └─ extension.ts       # Main extension logic
│
├─ dist/                  # Compiled JavaScript (generated by `npm run compile`)
│
├─ package.json           # Extension manifest (metadata, commands, dependencies)
├─ package-lock.json      # Dependency lock file
├─ tsconfig.json          # TypeScript configuration
├─ esbuild.js             # Build script
├─ .vscodeignore          # Files to exclude from the VSIX package
├─ README.md              # Extension README for publishing
├─ CHANGELOG.md           # Version history
```

---

## How It Works

### 1. Activation

The extension activates when:
- Positron starts (`onStartupFinished`)
- A command is run (`makeExercise.code`, `makeExercise.no`, `makeExercise.yes`, `makeExercise.pick`)

### 2. Commands

Defined in `package.json` under `contributes.commands`:
- **Insert Exercise: code** → `make_exercise("code")`
- **Insert Exercise: no-answer** → `make_exercise("no-answer")`
- **Insert Exercise: yes-answer** → `make_exercise("yes-answer")`
- **Insert Exercise (choose type)** → Opens a dropdown to pick the exercise type.

### 3. Positron API

Uses `@posit-dev/positron` to execute R code inside the active Positron R session.

### 4. Status Bar Button

A status bar button (left side) appears after activation:
- Label: "➕ Exercise"
- Click → Opens the exercise type picker

---

## Development Workflow

### **One-time setup**
1. Install [Node.js 20.x](https://nodejs.org/) (Positron requires this range for compatibility).
2. Install npm dependencies:
   ```sh
   cd positron-tutorial-helpers/
   npm install
   ```

---

### **Running in Development Mode**

1. Open the `tutorial.helpers` root folder in Positron.
2. Ensure `.vscode/launch.json` is set to load from the `positron-tutorial-helpers/` folder:

   ```json
   "--extensionDevelopmentPath=${workspaceFolder}/positron-tutorial-helpers"
   ```
3. Compile:

   ```sh
   cd positron-tutorial-helpers
   npm run compile
   ```
4. Press **F5** in Positron to launch an Extension Development Host.
5. In the new window, test the extension commands via:

   * **Command Palette** (Ctrl+Shift+P → search for "Insert Exercise…")
   * **Status Bar Button** ("➕ Exercise")

---

### **Watching for Changes**

Run:

```sh
npm run watch
```

Then press **F5** — changes will auto-compile as you edit `src/extension.ts`.

---

## Packaging & Publishing

### **1. Package into VSIX**

To create a `.vsix` file:

```sh
cd positron-tutorial-helpers
npx @vscode/vsce package
```

Output example:

```
DONE  Packaged: C:\path\to\positron-tutorial-helpers\positron-tutorial-helpers-0.1.0.vsix
```

---

### **2. Install Locally from VSIX**

```sh
code --install-extension positron-tutorial-helpers-0.1.0.vsix
```

For Positron:

* Open Positron
* Press **Ctrl+Shift+P**
* Run `Extensions: Install from VSIX`
* Select the `.vsix` file

---

### **3. Publish to VS Code Marketplace**

**Step 1: Create a publisher**
1. Go to https://marketplace.visualstudio.com/manage
2. Create a publisher account and note your publisher ID
3. Add the publisher ID to `package.json`:
   ```json
   "publisher": "<publisherId>"
   ```

**Step 2: Create a Personal Access Token**
1. Open https://dev.azure.com/
2. Go to User settings → Personal access tokens → New Token
3. Set expiration (any duration you prefer)
4. Under Scopes, select Marketplace: Acquire and Manage
5. No Work Items, Code, or Build scopes needed
6. Save the generated token

**Step 3: Allow vsce in PowerShell (Windows only)**
Open PowerShell as Administrator and run:
```powershell
Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
```

**Step 4: Login and publish**
```sh
# Install vsce globally
npm install -g @vscode/vsce

# Login once
vsce login <publisherId>

# Publish directly from source
vsce publish

# OR if you already built a VSIX file
vsce publish --packagePath <file>.vsix
```

Reference:
[https://code.visualstudio.com/api/working-with-extensions/publishing-extension](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)

---

## Updating the Extension

1. Make code changes in `src/`.
2. Update version in `package.json` (`"version": "x.y.z"`).
3. Recompile:

   ```sh
   npm run compile
   ```
4. Package:

   ```sh
   npx @vscode/vsce package
   ```
5. Publish:

   ```sh
   vsce publish
   ```

---

## Relevant Documentation

* **VS Code Extension API**: [https://code.visualstudio.com/api](https://code.visualstudio.com/api)
* **Positron API**: [https://docs.positron.posit.co/](https://docs.positron.posit.co/)
* **Publishing Extensions**: [https://code.visualstudio.com/api/working-with-extensions/publishing-extension](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)
* **Extension Manifest Reference**: [https://code.visualstudio.com/api/references/extension-manifest](https://code.visualstudio.com/api/references/extension-manifest)

---

## Troubleshooting

* **Command not found**
  Ensure `activationEvents` in `package.json` match your command IDs.
* **Extension doesn't run in Positron**
  Requires Positron 1.99+ and active R session.
* **vsce blocked in PowerShell**
  Run:

  ```powershell
  Set-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass
  ```

---

## Notes

* This extension will not appear in the Positron Marketplace unless separately published there.
* It **will** appear in VS Code Marketplace if published.
* `.gitignore` ensures large or generated files (`node_modules/`, `dist/`, `.vsix`) aren't committed.
