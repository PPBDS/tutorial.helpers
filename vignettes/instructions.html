<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Instructions for Writing R Tutorials</title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
</head>
<body>
<div class="include-before">
</div>
<div class="frontmatter">
<div class="title"><h1>Instructions for Writing R Tutorials</h1></div>
<div class="author"><h2>David Kane</h2></div>
<div class="date"><h3></h3></div>
</div>
<div class="body">
<!-- There are some tutorials which require either an R restart or (what is more or less the same thing, I think) the creation of a new R project. Clearest examples are: RStudio and Code, Rstudio and Github, and Quarto Websites. The problem arises because restarting R or creating a new R project causes R to terminate the tutorial. That is fine when working on a local machine, since the tutorial answers are saved and you can just restart the tutorial. But it does not (alway? ever?) work in the cloud. Restarting a tutorial which you terminated causes an error in the Cloud. -->
<!-- So, for these three tutorials and all others, we should explicitly have students create two RStudio instances, one in which they are doing the tutorial and one in which they are following the tutorial's instructions, instructions which will often require restarts and/or new projects. -->
<!-- Explain test code chunks! -->
<!-- Change the approach so that the advice covers all sorts of tutorials, not just tutorial.helpers. -->
<!-- I hate the way that all the weird formatting we do messes up the document outline. You can see that effect within R Studio and on the web page. Fixable? -->
<!-- Tutorial answers should require the smallest incremental number of characters for students to type. That is how you know that your learning curve is shallow. geom_smooth() example. -->
<!-- Add testing discussion of even loading libraries. -->
<p><em>There are no questions here. There are only simple instructions.</em></p>
<p><em>Tutorials are not challenging. They are confidence-building.</em></p>
<p><em>Every word matters. Never waste a student’s time.</em></p>
<h2 id="introduction">Introduction</h2>
<p>This document describes the best way to write R tutorials using the <a href="https://rstudio.github.io/learnr/"><strong>learnr</strong></a> package. The most common use case is a tutorial which covers <a href="https://ppbds.github.io/tutorial.helpers/articles/books.html">the material in an assigned textbook</a>, as with the <a href="https://CRAN.R-project.org/package=r4ds.tutorials"><strong>r4ds.tutorials</strong></a> package for <a href="https://r4ds.hadley.nz/"><em>R for Data Science (2e)</em></a> by Hadley Wickham, Mine Çetinkaya-Rundel, and Garrett Grolemund..</p>
<p>Instructors assign textbook readings to students. We want our students to read and, perhaps more importantly, go through the associated code, typing it in and confirming what it does. Sadly, students almost never do so. Fortunately, the <a href="https://CRAN.R-project.org/package=tutorial.helpers"><strong>tutorial.helpers</strong></a> package provides tools for ensuring that students type in all the assigned code.</p>
<p>Imagine the <em>shallowest</em> possible learning curve. Almost every student should be able to answer almost every Exercise, albeit perhaps with the help of a Hint. There are no hard questions. In fact, there really aren’t any <em>questions</em> at all. Instead, there are <em>instructions</em>: Do one thing, then the next, and then the next.</p>
<p>Assume that you are giving the student a private lesson. You ask them a question. They give you an answer. What would you say to them next? What do you want to teach them, given that context?</p>
<p>There are a million little bits of R (or statistics or data science or . . .) knowledge which we might provide to students: tips, tricks, cool packages, fun websites, et cetera. We don’t have time to mention all of them. The art of teaching is to, first, decide which 10,000 bits are the most important to mention and second, figure out the best time at which to mention them. Tutorials provide an occasion for that mentioning. Which bits do we mention and where do we mention them?</p>
<p>We can only demonstrate a tiny percentage of all the packages in the world, but we can certainly at least mention the existence of dozens more. Within the packages we use, we can only illustrate some of the functions; but we can examine some of the other important ones. Among the functions we use, we can only show some of the arguments; but we can discuss others.</p>
<p>The most important parts of the “knowledge drops” with which we pepper these tutorials are, first, the packages/functions/arguments which we mention without demonstrating, and second, links to high quality resources.</p>
<p>We are building a “<a href="https://ricomariani.medium.com/the-pit-of-success-cfefc6cb64c8">pit of success</a>.” Generally, students don’t do the assigned reading, at least in a large class. However, they will complete required work. They will do the assigned tutorials. <em>Our promise: If you complete the tutorials, you will learn the material. There is simply no way not to.</em></p>
<h2 id="set-up">Set Up</h2>
<p>Tutorials themselves live in a directory within <code>inst/tutorials</code> in whichever package you are working on. We recommend that this directory name be a combination of a prefix number (which indicate the week/chapter with which a tutorial is associated and/or the order in which to do it) and a name, which corresponds to the <code>id</code> of the tutorial. Within each directory is an R Markdown file and, sometimes, other material like an <code>images</code> or <code>data</code> directory. The prefix number determines the order in which tutorials appear in the Tutorial tab. By default, we name the R Markdown file <code>tutorial.Rmd</code>, but any name works as long as the file has the appropriate YAML header.</p>
<p>To create a new tutorial, use <code>File -&gt; New File -&gt; R Markdown...</code>. Choose the “From Template” option and then select “Helpers Tutorial” from the <strong>tutorial.helpers</strong> package. Follow the instructions.</p>
<p>The <code>id</code> value is important. It should be the same as the directory in which the tutorial is located, but with any leading numbers removed. It is used for the name of the answer file which students save at the end of the tutorial.</p>
<p>Note that tutorials must be <a href="https://rmarkdown.rstudio.com/">R Markdown</a> documents, meaning that their suffix is <code>.Rmd</code>. You can not (yet) use Quarto documents with tutorials. Fortunately, most of what you need which works in Quarto also works in R Markdown. The main difference is that code chunk options appear within the <code>{}</code>. Don’t worry about this detail. Just use the provided RStudio addin tools.</p>
<p>There is a <code>setup</code> code chunk at the top of a tutorial. You must have <code>library(learnr)</code> and, if you use our tools, <code>library(tutorial.helpers)</code> in this chunk. Our template also provide useful settings for various options.</p>
<p><strong>Warning</strong>: You must ensure that any library used in the tutorial is explicitly loaded in this setup chunk. Almost every tutorial makes use of functions from the <strong>tidyverse</strong> package, so be sure to load this. Unfortunately, nothing in our test suite captures the common error of using library X in the tutorial code and forgetting to load it in the setup chunk.</p>
<p>If your tutorials are part of an R package, then you should ensure that <strong>tutorial.helpers</strong> is included under Imports and that any library loaded in a tutorial is, at least, included under Suggests.</p>
<h2 id="structure">Structure</h2>
<p>The beginning of every tutorial includes the <code>copy-code-chunk</code> and the <code>info-section</code> code chunks. The tutorial is then divided into different <em>Sections</em> that appear as side panels. The first section is the “Introduction” and the last is the “Summary”.</p>
<p>Within the Sections, other than the Introduction and Summary, there are a series of <em>Exercises</em> which can include writing code or writing text. At the end of the tutorial, there is a <code>download-answers</code> code chunk which provides students with instructions on how to download a copy of their answers.</p>
<p>The Introduction section is two to four sentence about the main topics covered in the tutorial. Why are we here? What will students get out of giving you 90 minutes of their lives? What functions/techniques will they learn?</p>
<p>The Summary section is two to four sentences which bring the lessons of the tutorial together for the student. What do they know now that they did not know before? What are the most important functions/techniques covered? This should be very similar to the Introduction. You made a promise as to what they would learn. You kept that promise.</p>
<p>If there are one or two other key resources about the topic of the tutorial, then those resources should be mentioned somewhere in the tutorial and also in the Summary.</p>
<p>Anything typed at the keyboard belongs in `backticks` (not “quotation marks”), except for package names, which are always <strong>bolded</strong>. Function names always include the parentheses: <code>read_csv()</code>, not <code>read_csv</code>. Example: the <code>+</code> sign is used to connect <code>ggplot()</code> components when using the <strong>ggplot2</strong> library.</p>
<p>Ensure that the first few questions always require students to load any libraries which are used in the tutorial. That is, look at all the libraries you load in the set up chunk. (Try not to have too many of them.) All of them, except for <strong>learnr</strong> and <strong>tutorial.helpers</strong> merit an exercise which requires the student to type <code>library(package.name)</code>. This ensures that students get in the practice of loading libraries. And it also provides occasion to drop some knowledge. Don’t forget that all libraries you load should be included in the DESCRIPTION file — if the tutorial is part of a package — probably under Suggests.</p>
<h2 id="sections">Sections</h2>
<p>Tutorials are divided into <em>Sections</em> that appear on the side panel. To create these sections, we include a double hash (##) before the text for it to show up as a side panel. This is also called the <em>Section Title</em>.  Use <a href="https://apastyle.apa.org/style-grammar-guidelines/capitalization/sentence-case">sentence case</a>. On the line after the Section Title, put three hashes. This ensures that students will see the introductory text before they see the first Exercise.</p>
<p>Each Section begins with a sentence or two about what this group of Exercises is trying to accomplish. Example:</p>
<pre><code class="language-markdown">## Interacting with sites with `GET()`
###

In order to get data from an API, we use the **httr** package. The package is designed to 
imitate standard HTTP in R. Read more about HTTP [here](https://www.jmarshall.com/easy/http/).

### Exercise 1
</code></pre>
<p>The link will be formatted correctly once the tutorial is knitted. Section introductions will often have two parts: the introductory text as above and a plot which will be replicated in that section of the tutorial. Those two parts are generally separated by a triple hash.</p>
<p>After the last Exercise in a Section, you should put a triple hash and then give a two sentence summary about what this Section accomplished. A Section is a 20 minute transfer of knowledge from you to the student. At the beginning, you mentioned its purpose. Conclude by tying things back to that original purpose. Often, these “purposes” will be fairly trivial: You promised to go through an example of a scatter plot and, in fact, you did. And that is OK! We are not writing poetry. Not every Section leads to salvation.</p>
<p>One or two high quality links, specifically relevant to this Section, should be included/explained at either the beginning or end of a Section, unless the Section is very short.</p>
<h2 id="exercises">Exercises</h2>
<p>Each Section is composed of a series of numbered Exercises.</p>
<h3 id="flow">Flow</h3>
<p>Each Exercise should have a <em>flow</em> which requires that students hit the “Continue” button at least once.</p>
<ul>
<li>
<p>Begin with a <em>Start</em> which is a sentence or two of knowledge and/or the question itself. If the length of the Start text is longer than one or two lines, then do not place the question code chunk in the same part. Instead, the Start includes a triple hash, thereby creating the Continue button. If the length of the text is short enough that students are willing to read it (at most two sentences), you can include the Exercise code chunk in the same part.</p>
</li>
<li>
<p>Most of the time there is no need for a triple hash before the code chunk.</p>
</li>
<li>
<p>Do not expect students to read more than two sentences of text at a time. After two sentences, you almost always want to use a triple hash in order to create a Continue button so that students have a break. They won’t read more than two sentences without a break.</p>
</li>
</ul>
<!-- DK: This seems false. Rarely proceeded by a triple hash. -->
<ul>
<li>
<p>After the Start, come three code chunks:</p>
<ul>
<li>The Exercise code chunk is the location in which students will place their answers. It always includes the <code>exercise = TRUE</code> code chunk option.</li>
<li>The Hint code chunk includes any hints for the students. The code chunk name is the hint is always exactly the same as the one for the Exercise code chunk, except with <code>-hint-n</code> attached at the end. The <code>n</code> is replaced by the number of the hint. Almost always, there is only one hint, so the suffix is <code>-hint-1</code>. We always set <code>eval = FALSE</code> in the Hint code chunk since, often, the hint will not be legal R code.</li>
<li>The Test code chunk requires no chunk name. It always includes the <code>include = FALSE</code> code chunk option because we never want to show the code or the results to students. Instead, the purpose of the Test code chunk is to ensure that the correct answer — that is, the code we want students to enter into the Exercise code chunk — works.</li>
</ul>
</li>
<li>
<p>The three code chunks are always followed by a triple hash. We want students to pause after they have submitted their answers so that they are more likely to consider the output from their submission before moving on.</p>
</li>
<li>
<p>The last part of an Exercise is the End, our main opportunity to drop some knowledge. See the <a href="#kd">Knowledge Drops</a> section for extensive discussion.</p>
</li>
<li>
<p>The last part of the Section is another knowledge drop. It is not another Exercise. It is just a knowledge drop after the last Exercise which tries to take a broader overview. Again, this can’t be more than a sentence or two. But it should be more substantive than a simple “Good job.”  Recall the 10,000 items which we want to mention. For example, if the Section has involved creating a scatter plot, then the last Exercise will be putting the final touches on that scatter plot. The knowledge drop should be something about scatter plots in general, not a minor point about the particular scatter plot which the student has just created.</p>
</li>
</ul>
<h3 id="question-types">Question types</h3>
<p>To create the Exercise headers, you use three hashes. Make sure you number your exercises – <code>### Exercise 1</code>, <code>### Exercise 2</code> and so on.</p>
<p>There are two main types of questions. First, we have normal <em>coding</em> questions. Students write code and press the Run Code button. Second, we have <em>text</em> questions which require students to either write prose or to copy/paste the results of running specific commands. Prose is needed for questions like “Explain the meaning of potential outcomes.” Copy/paste situations arise when students are instructed to do something like connect to Github or edit a qmd. We confirm that the students have completed these questions by having them issue a command like <code>list.files()</code> and then copy/pasting the command and the output. We often abbreviate those instruction using CP/CR, which stands for <strong>c</strong>opy and <strong>p</strong>aste the <strong>c</strong>ommand and the <strong>r</strong>esult.</p>
<h4 id="code-questions">Code questions</h4>
<p>Here is an example code question:</p>
<pre><code class="language-r">### Exercise 2

Start your code with `cces`. Use the pipe operator `|&gt;` to add the 
function `filter()`, selecting the  rows where `state` is equal to 
&quot;Massachusetts&quot;. To set something equal to a value in `filter()` 
use two equal signs: `==`.

```{r filter-2, exercise = TRUE}
```

```{r filter-2-hint-1, eval = FALSE}
cces |&gt; 
  filter(state == &quot;...&quot;)
```

```{r filter-2-test, include = FALSE}
cces |&gt; 
  filter(state == &quot;Massachusetts&quot;)
```
### 

`==` is used because it is **checking** whether the value of the 
variable on the left is equal to the value on the left. See 
[here](https://stat.ethz.ch/R-manual/R-devel/library/base/html/Comparison.html) 
for discussion of other relational operators in R.
A single equation symbol, `=`, is used to set something equal to 
something else. 
</code></pre>
<p>First, the Start of the Exercise sets the stage. It sometimes teaches something new, connects to a previous Exercise, provides a useful link, whatever. If it is long enough, it is followed by a triple hash. If not, the text continues to the instruction. Most of the time, as above, there is only the instruction, telling the student, step-by-step, what to do.</p>
<p>Second, the instruction requires that students write some code. Good instructions generate results when the student presses Run Code. Tutorial answers should require the smallest incremental number of characters, relative to the last question, for students to type. That is one way you know that your learning curve is shallow. If a Exercise code chunk requires the students to type a lot of characters, you should split up the Exercise into multiple separate Exercises.</p>
<p>Third, any Exercise which requires the copying of code from the prior Exercise should place the <em>Copy previous code</em> button below the Exercise code chunk.</p>
<pre><code class="language-markdown">&lt;button onclick = &quot;transfer_code(this)&quot;&gt;Copy previous code&lt;/button&gt;
</code></pre>
<p>Fourth, tutorials should be so simple that 95% of the students can answer 95% of the questions easily. One way to ensure that is to add a <em>Hint</em> to almost every coding question.</p>
<p>Hints must always have the same code chunk name as the exercise chunk for which they are the hint, with a “-hint-n” added at the end. So, if an exercise code chunk is named “ex-1”, then the hint associated with that exercise is named “ex-1-hint-1”. A second hint for that same question would be named “ex-1-hint-2”, and so on.</p>
<p>When you create a hint, always use <code>eval = FALSE</code> within the parentheses in the code chunk. This is because hints will often include “…” and other symbols which do not run as correct R code. So, we need to tell R not to run it or an error will occur during <code>R CMD check</code>. Example:</p>
<pre><code class="language-r">```{r ex-1-hint-1, eval = FALSE}
This is an example hint. Normally sentences like these 
would cause an error in R because it is not proper code. 
However, since we include eval = FALSE in the r-chunk, 
R ignores all errors!
```
</code></pre>
<p><strong>You need to wrap the text in a long hint by hand, inserting the carriage returns yourself.</strong> R will not wrap the text automatically.</p>
<p>Often, hints look like this:</p>
<pre><code class="language-r">```{r ex-1-hint, eval = FALSE}
... |&gt; 
  filter(year = ...) |&gt; 
  ...(flights)
```
</code></pre>
<p>The “…” indicates places where the student needs to insert some code, a value or a function name. The code in hints should be formatted correctly.</p>
<p>Students can not see the first hint after clicking through to the next hint. So, make sure the last hint is the one you most want them to have access to, i.e., the one which provides the key information. If students can see the last hint, they should have no reason to consult any earlier hints. We rarely provide more that one hint.</p>
<p>Hints are <a href="https://community.rstudio.com/t/hints-in-written-questions/108184">only allowed</a> for coding questions, <strong>not for text questions</strong>.</p>
<p>Fifth, we separate the code chunks from the End of the Exercise by using <code>###</code> again.</p>
<p>For simple questions which result in a display of some data, one approach is to write “You should see that the value of height in row 1 is 23.” This allows the students to know that they are on the right track. Never hard-code a number. Use R to inline calculate it, even though this can be a bother.</p>
<p>But, much more common, is to use the End to drop some knowledge, especially about a function which was used in the answer to this Exercise, or to one of the previous Exercises in this Section.</p>
<h4 id="text-questions">Text questions</h4>
<p>There are two types of text questions: 1) those that provide the students with the correct answer, after they have submitted their own answer, and, 2) those that do not provide an answer.  Examples:</p>
<pre><code class="language-r">### Exercise 6

Explain potential outcomes in about two sentences.

```{r definitions-ex-6}
question_text(NULL,
    message = &quot;This is where we place the correct answer. It will appear only after 
    students have submitted their own answers. Note that we do not need to wrap the 
    answer text by hand.&quot;,          
    answer(NULL, 
           correct = TRUE),
    allow_retry = FALSE,
    incorrect = NULL,
    rows = 6)
``` 
</code></pre>
<p>For the <code>message</code> argument, you should provide an <strong>excellent</strong> answer. We want to allow students to check for themselves that they got, more or less, the correct answer. Note how we set <code>allow_retry</code> to FALSE. This means that, after they see our answer, students can’t modify their answer. The <code>rows</code> argument decides how many rows the empty text input will have.</p>
<p>Always specify (approximately) how much you want students to write. Reasonable units are: one sentence, two sentences and a paragraph. Pick one of these three unless you have a good reason not to.</p>
<p>For paragraph questions, you should mention specific words or phrases which the students should include in their answers. If your suggested answer includes the word “validity,” for example, then tell the students to include (and define) validity as part of their answer.</p>
<p>However, for many written questions, we don’t provide an answer, so we don’t mind if students resubmit. In that case, we use</p>
<pre><code class="language-r">### Exercise 7

From the Console, run `list.files()`. CP/CR.

```{r file-creation-7}
  question_text(NULL,
    answer(NULL, correct = TRUE),
    allow_retry = TRUE,
    try_again_button = &quot;Edit Answer&quot;,
    incorrect = NULL,
    rows = 3)
```
</code></pre>
<p>This format is most commonly used for “process” questions in which we have told students to do something and then confirm that they have done it by copying/pasting the result from a command.</p>
<h3 id="tips">Tips</h3>
<p>Each coding exercise should always spit out something. Interactivity is good! Students should always look at what their code is producing. There are some situations in which students need to make assignments and which, because of this, will result in no output when the Run Code button is pressed. But:</p>
<ul>
<li>
<p>Do this as little as possible. Why not just make a pipe?</p>
</li>
<li>
<p>When you do this, you will need to create the permanent object yourself because student work in an Exercise code chunk has no lasting effects. Doing so is annoying and error prone.</p>
</li>
<li>
<p>You can have the student not only do the assignment but also, as part of this same exercise, print out the object. This works well.</p>
</li>
</ul>
<p>Follow a coding <a href="https://style.tidyverse.org/">Style Guide</a>, especially spaces around operators like “ = “. Use only one command per line in pipes and graphics, with proper indentation. Indent plotting commands after the call to <code>ggplot()</code>.</p>
<!-- DK: Standardize this to refer to Tidyverse Guide, or elsewhere? -->
<p>Do not create an object in one question and then assume that it will be available in subsequent questions. It won’t be! Each question is independent of every other question. They live in separate R instances. The only exception (which we make use of) is that objects created in the initial <code>setup</code> chunk for the entire tutorial are available in all later questions, just the way that <code>library()</code> commands executed there do not need to be executed again.</p>
<p>Code chunks for Exercises must be named.</p>
<p>Tutorials are knitted/run from the directory in which they are located. So, if you want to read in a file from a <code>data/</code> directory, you write:</p>
<pre><code class="language-r">x &lt;- read_csv(&quot;data/myfile.csv&quot;)
</code></pre>
<p>in an R code chunk, presumably in the global <code>setup</code> chunk. But, if you try to execute that line of code with CMD-Return, it will fail because, by default, you are located in the main directory of <strong>your.package</strong> when you start working on your tutorials. Using <code>setwd()</code> will solve this problem.</p>
<pre><code class="language-markdown">&gt; getwd()
[1] &quot;/Users/davidkane/Desktop/projects/r4ds.tutorials&quot;
&gt; setwd(&quot;inst/tutorials/031-data-files/&quot;)
&gt; getwd()
[1] &quot;/Users/davidkane/Desktop/projects/r4ds.tutorials/inst/tutorials/031-data-files&quot;
&gt; 
</code></pre>
<p>CMD-Return will now work because your R session is “located” in the same location as that from which the tutorial will be run when it is knitted.</p>
<h3 id="pipes">Pipes</h3>
<p>The most common type of code questions involve the step-by-step process of building a pipe, the final output of which is a nice looking graphic.</p>
<p>You want to first show the graphic that you will create by the end of the Section. You show it once at the start of the Section and once before the last Exercise, as a reminder of what the graphic should look like so students do not need to scroll all the way back up.</p>
<p>You should put the code for the graph in the code chunk at the start of the Section. Save the code to an object. The name of the object should have a “_p” suffix, where the “p” stands for “plot.” This way, you only have to put the object name in the code chunk at the end of the Section rather than copying the code.</p>
<p>You then build up the graphic, line by line, over a series of Exercises, providing hints along the way.</p>
<h3 id="knowledge-drops">Knowledge Drops<a id="kd"></a></h3>
<p>The most difficult part of tutorial creation is writing the “knowledge drops,” the snippets of wisdom (and the associated links) which are used at the End of each Exercise. Some advice:</p>
<ul>
<li>
<p>Do not expect this to be easy! Good knowledge drops are hard.</p>
</li>
<li>
<p>Make them short. Students will not read more than a sentence or two.</p>
</li>
<li>
<p>Not sure what knowledge to drop? Look up the help page for one of the functions used in the Section. Ideally, this will be the function which was used in this Exercise, but it can be one used a few lines above. The help page will have two areas of interest:</p>
<ul>
<li>Arguments for the function, some of which will not have been used in the Section but which are still worth mentioning. A good knowledge drop will mention this argument and describe when it might be useful.</li>
<li>Related functions. For example, use the “Useful filter functions” section of the <code>?dplyr::filter</code> help page. All of these make for good knowledge drops! Another example is the “See also” section of the <code>?arrange</code> help page. We can’t possibly use every R function in an Exercise, but we can at least describe some of them in knowledge drops.</li>
</ul>
</li>
<li>
<p>Use high quality links.</p>
<ul>
<li>The second edition of <a href="https://r4ds.hadley.nz/"><em>R for Data Science</em></a> is amazing. Link to it as often as you can.</li>
<li>Anything associated with <a href="https://posit.co/">Posit</a> (formerly named RStudio) is high quality. Examples include sites associated with <a href="https://www.tidyverse.org/">Tidyverse</a> and <a href="https://www.tidymodels.org/">Tidymodels</a>.</li>
</ul>
</li>
<li>
<p>Avoid links to low quality sites like <code>https://rdrr.io/</code> , <code>https://www.rdocumentation.org/</code>, and <code>https://www.datamentor.io/</code>. Any site which uses ads should be avoided.</p>
</li>
<li>
<p>Links to function documentation is useful. Indeed, we should link at least once to the documentation for every function which we use. Two categories:</p>
<ul>
<li>Links to the help pages for base function are tricky. It is not clear to me which location is the best to use for this purpose. My suggestion is to use links involving the <code>stat.ethz.ch</code> server, which is the home base (I think) for the core R developers. Consider examples for <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/cut.html"><code>cut()</code></a> and <a href="https://stat.ethz.ch/R-manual/R-devel/library/base/html/print.html"><code>print()</code></a>.</li>
<li>Links to functions from the <em>Tidyverse</em> should use the docs maintained by Posit. Consider these examples for <a href="https://dplyr.tidyverse.org/reference/arrange.html"><code>arrange()</code></a> and <a href="https://tidyverse.github.io/ggplot2-docs/reference/aes.html"><code>aes()</code></a>.</li>
</ul>
</li>
<li>
<p>One common approach is like this:</p>
</li>
</ul>
<pre><code>See `?readr::locale` for [details](https://readr.tidyverse.org/articles/locales.html).
</code></pre>
<p>Note how we concisely provide both the command which brings up the help page and a link to the help page itself.</p>
<p>Think back to our initial discussion of the 10,000 pieces of information which we want to mention at some point. Among these are many pages linked to from the help pages for the core <em>Tidyverse</em> functions, like <code>arrange()</code> and <code>aes()</code>.</p>
<!-- DK: Everything below is worth re-writing. -->
<h2 id="inputs">Inputs</h2>
<h3 id="tibbles">Tibbles</h3>
<p>There are two main sources for tibbles for use in the tutorials. First, use built-in data sets. Run <code>library(tidyverse)</code> or any other package. Then, run <code>data()</code>. This will pull up a list of available data sets, both those in the base R packages and those in any other packages you have loaded. Note that some of these will be data frames rather than tibbles. Second, you can store data — either as csv or rds files — in the <code>data</code> directory of a tutorial, as discussed below.</p>
<h3 id="images">Images</h3>
<p>To add images to a tutorial, first make a directory called <code>images</code> in the folder that contains the <code>tutorial.Rmd</code>. Store all images for that tutorial there. You can work with those files in all the usual ways.</p>
<p>Use <code>include_graphics()</code> to add the image into the document. Include this code in its own chunk, in the place where you want the image to appear in the tutorial.</p>
<pre><code class="language-r">```{r}
include_graphics(&quot;images/example.png&quot;)
```
</code></pre>
<p><code>include_graphics()</code> is part of the <code>knitr</code> package, so you need <code>library(knitr)</code> in the setup code chunk. Note that you do not need to name these code chunks.</p>
<h3 id="files">Files</h3>
<p>Files — most commonly text files or rds files — are handled in a similar fashion to images. Create a directory called <code>data</code> in the same directory as the <code>tutorial.Rmd</code>, just as we do with <code>images</code>. Any file in <code>data</code> will be available at run time. (Note that the directory must be named <code>data</code>. Something like <code>my_data</code> will not work.)</p>
<p>There are two main uses for files in <code>data</code>. First, they can be used at “compile time” (when the <code>tutorial.Rmd</code> is knit to html) for making plots or doing anything else. Second, and more importantly, they are available to students in the exercise code blocks during “run time” (when students are doing the tutorial).</p>
<h3 id="permanent-objects">Permanent objects</h3>
<p>If you need for an R object to be accessible in an Exercise code chunk, create it in the initial global <code>setup</code> code chunk at the top of the tutorial.</p>
<h2 id="checks">Checks</h2>
<p>The simplest way to test the <code>tutorial.Rmd</code> with which you are working on is to hit the “Run Document” button. This is the same thing as running <code>rmarkdown::render()</code> on that file:</p>
<pre><code class="language-r">rmarkdown::render(&quot;inst/tutorials/02-terminal/tutorial.Rmd&quot;)
</code></pre>
<p>This assumes that you are located in the main directory of <strong>your.package</strong>, as you normally would be. I am not sure if this will catch all potential errors, but it will catch many issues, and it is very quick. Replace <code>02-terminal</code> with the appropriate directory.</p>
<h3 id="test-before-submitting-a-pr">Test before submitting a PR</h3>
<p>Once you are done editing your tutorial, you need to make sure it works before you submit a pull request.</p>
<ol>
<li>
<p>Click “Install and Restart” from the Build tab. Then, hit “Start Tutorial” in the Tutorial tab. This mimics the experience that users will have. This will catch some common errors, like having two code chunks with the same name. (I am not sure if this does more or less than the simple test as above.)</p>
</li>
<li>
<p>Do a full test, which means running <code>R CMD check</code>. Go to the top right window of RStudio. Click the Build pane and hit the “Check” button (with the green check mark). You will then see a bunch of code and tests running. Make sure it says “OK” next to “testthat”. You should always run this before submitting a pull request.</p>
</li>
</ol>
<h3 id="what-to-do-if-r-cmd-check-fails">What to do if <code>R CMD check</code> fails</h3>
<ol>
<li>
<p>Read the error message at the bottom of the Build pane. You want to see “R CMD check succeeded.” If not, there is a problem. The error message will often provide a clue as to where in your code the error occurred.</p>
</li>
<li>
<p>If that error message is not detailed enough, go to the <code>your.package.rcheck</code> folder, which should be located in the same directory as <code>your.package</code> on your computer. This is a folder created by the <code>R CMD check</code> process, and it will be automatically deleted if the check process succeeds. If the process fails, the <code>your.package.rcheck</code> folder stays around so that you can examine it. The key file is <code>testthat.Rout.fail</code>, which should be in the <code>tests</code> directory. It has more details on what went wrong.</p>
</li>
</ol>
<p>The most common source of errors is something wrong with the hint code chunks, which are not evaluated when you just Run Document. Make sure the <code>eval = FALSE</code> argument is set in the code chunk for all hints.</p>
<h3 id="difficult-bugs">Difficult bugs</h3>
<ul>
<li>
<p>The most common issue is that an author will use a package like <strong>ggthemes</strong> in their tutorial but then forget to include <code>library(ggthemes)</code> in the setup code chunk. This will not cause any error in checking because <strong>ggthemes</strong> is not actually used in the tutorial itself, so the tutorial knits without a problem. But then the student tries to type <code>library(ggthemes)</code> as an answer to an exercise and gets an error because the package has not been installed. This issue helps to illustrate why having plots which are built on the fly is so valuable: it guarantees that student answers will work since the same code worked when the tutorial was knitted. The main lesson: For any package used, have a question which explicitly asks the student to load the package. In the Test chunk for that question, load the package yourself. This guarantees the availability of the package.</p>
</li>
<li>
<p>Note that <code>R CMD check</code> does not seem to catch cases in which you <code>library()</code> a package in a tutorial but that package is not in DESCRIPTION. But such a discrepancy will cause an error on Github Actions because, there, you only have access to packages that have been installed as part of that test.</p>
</li>
<li>
<p>Be careful of the way that Github is sloppy in how it deals with capitalization changes, especially when you change the name of a file. For example, you might first commit a file named <code>Rproj.png</code>. Later, you decide to change all file names for images to all lower case. So, you change the name of the file to <code>rproj.png</code>. Commit and push. Everything is great, right? No! Even if Github shows you the new file name it might still have that file as <code>Rproj.png</code> internally, with the capital “R”. This will cause errors when your run your checks on Github:</p>
</li>
</ul>
<pre><code>Error: Cannot find the file(s): &quot;images/rproj.png&quot;
</code></pre>
<p>But the file is there! You can see it! The tests work on your local machine. The easiest solution is to delete the file (and commit that change). And then change the name of the file to something else and use it.</p>
<ul>
<li><code>R CMD check</code> will test that all tutorials have the default sections exactly as they are in the Helper Tutorial template. So, use the template. If either the “Information” or “Download answers” sections are missing, <code>R CMD check</code> will return something like “Missing a component part from file /path/to/your/Rmd/file.Rmd”.</li>
</ul>
</div>
<div class="include-after">
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
</body>
</html>
